<ng-container *ngIf="CraDataLoaded">
  <div class="row">
    <!-- top bar selects month & year -->
    <div class="col-md-12 text-center">
      <a class="btn" (click)="prevMonth($event)">
        <i class="fa fa-chevron-left"></i>
      </a>
      <select [(ngModel)]="currentMonth" (ngModelChange)="changeMonth(currentMonth)" id="month">
        <option selected [ngValue]="0" selected disabled>Select a month</option>
        <option [ngValue]="1">Janvier</option>
        <option [ngValue]="2">Février</option>
        <option [ngValue]="3">Mars</option>
        <option [ngValue]="4">May</option>
        <option [ngValue]="5">Avril</option>
        <option [ngValue]="6">Juin</option>
        <option [ngValue]="7">Juillet</option>
        <option [ngValue]="8">Aout</option>
        <option [ngValue]="9">Septembre</option>
        <option [ngValue]="10">Octobre</option>
        <option [ngValue]="11">Novembre</option>
        <option [ngValue]="12">Décembre</option>
      </select>
      <select [(ngModel)]="currentYear" (ngModelChange)="changeYear(currentYear)" id="year">
        <option [ngValue]="0" selected disabled>Select a year</option>
        <option [ngValue]="2017">2017</option>
        <option [ngValue]="2018">2018</option>
      </select>
      <a class="btn" (click)="nextMonth($event)">
        <i class="fa fa-chevron-right"></i>
      </a>
    </div>

    <!-- cra begin -->

    <div class="col-md-12">
      <ng-container *ngFor="let rubrique of currrentCra.rubriques">
        <table class="table table-hover table-bordered table-striped tg">

          <thead>

            <ng-container *ngIf="rubrique.libelleRubrique == 'PROJETS'">
              <tr>
                <th style="border:0px solid #fff !important;">Actions</th>

                <th class="tg-031e text-center projects" colspan="2">{{rubrique.libelleRubrique}}</th>


                <ng-container *ngFor="let day of daysN;let i = index">
                  <th class="tg-031e text-center week-end" *ngIf="day == 'D' || day == 'S'">
                    <span class="">{{ day }}</span>
                  </th>
                  <th class="tg-031e text-center simple-day" *ngIf="day != 'D' && day != 'S'">
                    <span>{{ day }}</span>
                  </th>
                </ng-container>

                <th class="blue text-center" colspan="2">Total</th>
              </tr>
              <tr>
                <th style="border:0px solid #fff !important;"></th>
                <th class="tg-031e text-center" *ngFor="let sousRubrique of rubrique.libelleSousRubrique">{{sousRubrique.titre}}</th>

                <th *ngFor="let day of daysN;let i = index" class="tg-031e text-center">{{i+1}}</th>
              </tr>
            </ng-container>

            <ng-container *ngIf="rubrique.libelleRubrique == 'PROJET NON FACTURABLE'">
              <tr>
                <th style="width:80px;border:0px solid #fff !important;">
                  Actions
                </th>

                <th class="tg-031e text-center projects" colspan="2">{{rubrique.libelleRubrique}}</th>

                <ng-container *ngFor="let day of daysN;let i = index">
                  <th class="tg-031e text-center week-end" *ngIf="day == 'D' || day == 'S'">
                    <span class=""></span>
                  </th>
                  <th class="tg-031e text-center simple-day" *ngIf="day != 'D' && day != 'S'">
                    <span></span>
                  </th>
                </ng-container>

                <th class="blue text-center" colspan="2">Total</th>
              </tr>

            </ng-container>

            <ng-container *ngIf="rubrique.libelleRubrique == 'HORS PROJET'">
              <tr>
                <th style="border:0px solid #fff !important;">
                  Actions
                </th>

                <th class="tg-031e text-center projects" colspan="2">{{rubrique.libelleRubrique}}</th>


                <ng-container *ngFor="let day of daysN;let i = index">
                  <th class="tg-031e text-center week-end" *ngIf="day == 'D' || day == 'S'">
                    <span class=""></span>
                  </th>
                  <th class="tg-031e text-center simple-day" *ngIf="day != 'D' && day != 'S'">
                    <span></span>
                  </th>
                </ng-container>

                <th class="blue text-center" colspan="2">Total</th>
              </tr>

            </ng-container>

            <ng-container *ngIf="rubrique.libelleRubrique == 'REGULARISATION'">
                <tr>
                  <th style="border:0px solid #fff !important;">
                    Actions
                  </th>
  
                  <th class="tg-031e text-center projects" colspan="2">{{rubrique.libelleRubrique}}</th>
  
  
                  <ng-container *ngFor="let day of daysN;let i = index">
                    <th class="tg-031e text-center week-end" *ngIf="day == 'D' || day == 'S'">
                      <span class=""></span>
                    </th>
                    <th class="tg-031e text-center simple-day" *ngIf="day != 'D' && day != 'S'">
                      <span></span>
                    </th>
                  </ng-container>
  
                  <th class="blue text-center" colspan="2">Total</th>
                </tr>
  
              </ng-container>

          </thead>
          <tbody>
            <!-- rubriques -->


            <tr *ngFor="let ligne of rubrique.lignes">

              <td class="text-center" style="width:100px;border:0px solid;">

                <ng-container *ngIf="ligne.jours.afficheCompleterEtVider == true">
                  <button type="button" class="btn btn-sm" style="border-radius:50%;background-color:red;color:blue" (click)="clear(project)">
                    <i class="fa fa-ban"></i>V
                  </button>
                  <button type="button" class="btn btn-sm" style="border-radius:50%;background-color:grey;color:#fff" (click)="complete(project)">
                    <i class="fa fa-chevron-right"></i>C
                  </button>
                </ng-container>

                <ng-container *ngIf="ligne.jours.afficheSupprimer == true">
                  <button type="button" class="btn btn-sm" style="border-radius:50%;background-color:grey;color:#fff" (click)="delete(project)">
                    <i class="fa fa-trash"></i>S
                  </button>
                </ng-container>

              </td>
              <ng-container *ngIf="rubrique.libelleRubrique == 'HORS PROJET'">
                <td class="tg-031e  text-center hp" colspan="2">
                  <a title="">{{ligne.composantsRubrique[0].label}} </a>
                </td>
              </ng-container>

              <ng-container *ngIf="rubrique.libelleRubrique != 'HORS PROJET'">
                <td class="tg-031e  text-center custmor" *ngFor="let composant of ligne.composantsRubrique">
                  <a title="{{composant.tooltip}} ">{{composant.label}} </a>
                </td>
              </ng-container>


              <td class="tg-031e  text-center" *ngFor="let jour of ligne.jours.joursAffectation;let i=index">
                <ng-container *ngIf="jour.taux != null">
                  <select [(ngModel)]="jour.taux" (ngModelChange)="change(project,i)" class="select-cra">
                    <option [ngValue]="0"></option>
                    <option [ngValue]="1">1</option>
                    <option [ngValue]="1/2">1/2</option>
                    <option [ngValue]="1/3">1/3</option>
                    <option [ngValue]="1/4">1/4</option>
                  </select>
                </ng-container>
                <ng-container *ngIf="jour.taux == null">
                  <select [(ngModel)]="jour.taux" (ngModelChange)="change(project,i)" class="select-cra">
                    <option [ngValue]="0" selected></option>
                    <option [ngValue]="1">1</option>
                    <option [ngValue]="1/2">1/2</option>
                    <option [ngValue]="1/3">1/3</option>
                    <option [ngValue]="1/4">1/4</option>
                  </select>
                </ng-container>
              </td>

              <td class="tg-031e  text-center {{ligne.jours.totaleStyle}}">
                {{ligne.jours.totale}}
                <!--{{ project.joursT|number: '1.1-2' }}-->
              </td>

            </tr>

          </tbody>
        </table>
      </ng-container>
    </div>
    <div class="col-md-12">
      <textarea name="commentaire" id="" cols="60" rows="4">{{currrentCra.commentaire}}</textarea>
    </div>

  </div>

</ng-container>